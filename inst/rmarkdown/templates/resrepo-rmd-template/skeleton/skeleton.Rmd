---
title: "Resrepo Rmarkdown template"
author: "Your Name"
date: "`r format(Sys.time(), '%d %B, %Y')`"
knit: resrepo::knit_to_results
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## resrepo-specific notes

### YAML options

The `knit: resrepo::knit_to_results` line causes this document to knit to a 
directory under results. This output directory will have the same name as the 
filename of this Rmd document, e.g. `s01_process_data`.

The `output: pdf_document` line sets the output to a PDF document. 
Output options include: `pdf_document`; `html_document`; `github_document`; 
`word_document`. For more information 
see https://bookdown.org/yihui/rmarkdown/output-formats.html.

### setting directories

In this chunk we define the input and output directories: 

* `data_dir`: data folders where inputs for this document's code are; 
* `output_dir`: output folder where any outputs or results should be saved, e.g. 
plots or intermediate data files.

In an RMarkdown document within a `resrepo` repository, it easy to find a file 
or folder by using the function `path_resrepo`. 

You can use `path_resrepo` to read in a particular file, or create a variable 
that is the path to your data folder so that you can use it every time you 
read in data.

Writing output is equally easy. It is good practice to use directories in
`/data/intermediate` and `/results` with the same name as the script. For
example, if this document is called `plots`, we could use 
`/data/intermediate/plots` and `/results/plots`. 

See the `resrepo` vignette for more details and an example of reading and 
writing files using `path_resrepo`.

TODO: Do we want to automatically create an intermediate dir and results dir
that match the name of the Rmd script? Then the renv file could go directly 
to the results folder

```{r set-directories}
library(resrepo)
## set the relative filepath to the input data directory for this analysis
data_dir <- path_resrepo("/data/raw/default")
data_dir # print out

## and similar for where the results/outputs of this file go
output_dir <- path_resrepo("/data/intermediate/plots")
output_dir # print out
## we also need to create this folder if it doesn't already exist
dir.create(output_dir, showWarnings = FALSE)

```

***

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for 
authoring HTML, PDF, and MS Word documents. For more details on using 
R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes 
both content as well as the output of any embedded R code chunks within the 
document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent 
printing of the R code that generated the plot.

***

## Recording R environment

Part of ensuring our workflow is reproducible is to keep track of the R environment.
We will automatically save our R environment into a file called `r_environment.json`.

```{r save-r-environment}
filename_rmd <- rstudioapi::getSourceEditorContext()$path
filename_renv <- paste0(output_dir, "/renv_", 
                       tools::file_path_sans_ext(basename(filename_rmd)),
                       ".json")
renv::lockfile_write(renv::lockfile_create(), file=filename_renv)
print(sessionInfo())
```



