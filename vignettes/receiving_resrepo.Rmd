---
title: "Receiving a resrepo repository"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Data versioning}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
---

Welcome to your resrepo repository! If you are reading this it means that someone 
has giving you access to a resrepo repository. 
This vignette covers how to: 

1. Clone a resrepo repository;
2. Obtain the data you need;
3. Set up symlinks to the location of the data

## 1 & 2. Clone a resrepo repository and download data


@TODO: Clone the resrepo_penguins repository - create gif

```{r setup, echo=FALSE, results='hide'}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)

#library(resrepo)
directory_penguins <- file.path(tempdir(), "resrepo_penguins")
if (!dir.exists(directory_penguins)) dir.create(directory_penguins)

# clone the penguin repository (public)
git2r::clone("https://github.com/EvolEcolGroup/resrepo_penguins",
             local_path = directory_penguins,
             branch = "main",
             progress = TRUE)

knitr::opts_knit$set(root.dir = directory_penguins)

```


So you have cloned a resrepo repository with code in it, but the data to run the 
analyses are stored somewhere else outside the cloned repository.
```{r}
fs::dir_tree()
```


As you can see, this repository contains the folder `version_meta` which indicates to us that this
repository has been versioned. If you are not familiar with the concept of versioning,
please check the  `data versioning` vignette. 

Because this repository has been versioned, we need to run `version_setup()` to set up versioning in our 
local repository 
```{r}
version_setup(quiet = TRUE, resources_path = NULL)
```


Again, as you can see from the above tree, the `data/intermediate` and `data/raw` are empty folders, 
this is because no data are stored in the repository. 
Instead, the `data/intermediate` and `data/raw` folders are actually symlinks pointing to 
an external folder containing different versions of the data. 
Therefore, you need to take two steps:

@TODO: does the first step make sense?

- Download the data from where they are stored and place them in a location of your choice (e.g. a folder on 
   your local machine, a synced folder, etc..)
- Set up the symlinks to point to the location of the data you just downloaded

Once you have cloned the repository, and placed the data in your desired location,
you can set up the symlinks to point to the location of the data.

## 3. Setting up symlinks to data

As an example, we will place the data in a temporary directory called `external_data_storage_new`.
It is important that your data folder is structured in the exact same way as the data folder
you were provided with, as otherwise `resrepo` will not be able to find the files.

```{r}

# create new external folder for data 
external_data_storage_new <- file.path(tempdir(), "external_data_storage_new")
unlink(external_data_storage_new, recursive = TRUE)
dir.create(external_data_storage_new)

# copy the data from the original external folder to the new one
file.copy(from = system.file("vignette_example/tux_measurements.csv", package="resrepo"),
          to = external_data_storage_new,
          overwrite = TRUE)

```


Now that our `external_data_storage_new` folder contains the data, we can set up the symlinks

To do so, we can use the function `update_links`.
```{r}
setwd(directory_penguins)
update_links()
resrepo::find_git_root(directory_penguins)
```








