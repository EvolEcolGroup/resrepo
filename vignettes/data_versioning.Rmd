---
title: "Data versioning"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Data versioning}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
example_dir <- file.path(tempdir(),"resrepo_example")
unlink(example_dir,recursive = TRUE)
dir.create(example_dir, showWarnings = FALSE)
example_repo <- git2r::init(example_dir)
git2r::config(example_repo, user.name = "Test", user.email = "test@example.org")
vignette_dir<-getwd()
knitr::opts_knit$set(root.dir = example_dir)
# setwd(example_dir)
```

In my scientific projects, data are simply too large to be stored in a git repository. 
However, you still want to keep track of the data you used for my analysis, and often you will
be using different code branches to explore alternative approaches (e.g. different data filtering).
`res_repo` allows you to track versions of the data directories used in your projects, 
allowing you to easily switch between different versions of the data.

# Ignoring data in your repository

The first step is to ignore the data in your repository. `git` is not designed for very large files,
and indeed Github has a limit of XXX TODO on the size of files that can be uploaded.
`resrepo` offers a simple function that will remove your data from the repository, and
avoid tracking any further data.

Let us start by recreating the example repository. This is the same repository
we created in vignette basic_workflow; if you still have that repository, you don't need to run the code below:

```{r}
library(resrepo)
init_resrepo()
file.copy(from = system.file("template_extra/tux_measurements.csv", package="resrepo"),
          to = path_resrepo("/data/raw/original/tux_measurements.csv"),
          overwrite = TRUE)
file.copy(from = system.file("template_extra/s01_download_penguins.Rmd", package="resrepo"),
          to = path_resrepo("/code/s01_download_penguins.Rmd"),
          overwrite = TRUE)
knit_to_results(path_resrepo("/code/s01_download_penguins.Rmd"))
file.copy(from = system.file("template_extra/s02_merge_clean.Rmd", package="resrepo"),
          to = path_resrepo("/code/s02_merge_clean.Rmd"),
          overwrite = TRUE)
knit_to_results(path_resrepo("/code/s02_merge_clean.Rmd"))
file.copy(from = system.file("template_extra/s03_pca.Rmd", package="resrepo"),
          to = path_resrepo("/code/s03_pca.Rmd"),
          overwrite = TRUE)
knit_to_results(path_resrepo("/code/s03_pca.Rmd"))
git2r::add(path=".")
git2r::commit(message="Save plot", all=TRUE)

```

Let us check that we do have indeed a full repository:
```{r echo=FALSE}
fs::dir_tree()
```
Technically, we need to ignore the data directories (`data/raw` and `data/intermediate`). 
In `resrepo`, we have a function `data_dir_ignore`, that will do this for us.
```{r}


```